///////////////////////////////////////////////////////////
//  POperation.cs
//  Implementation of the Class POperation
//  Generated by Enterprise Architect
//  Created on:      23-sty-2024 15:01:55
//  Original author: smial
///////////////////////////////////////////////////////////

using CodeModel;
namespace CodeModel {
	public class POperation : UCCallableOperation {
        public PresenterClass pres = null;
		public POperation(){}

        public override string GetElemName(){
            return Utils.ToCamelCase(name.Replace("!", ""));
        }

        public override string ToCode(int tabs){
			string ts = Utils.GetTabString(tabs);
            string code = ts + GetElemName() + GetParametersCode() + "{\n";
            foreach (Parameter par in parameters) {
                bool hasMultipleItems = par.baseDataItem.editableStateItem && par.baseDataItem.baseType.fields.Exists(di => TypeKind.Multiple == di.typeKind);
                code += ts + "\tthis.state." + (hasMultipleItems ? "base" + par.ToTypeCode() : par.ToVarCode()) + " = " + par.ToVarCode() + ";\n";
                if (hasMultipleItems) {
                    code +=  ts + "\tthis.state." + par.ToVarCode() + " = new " + par.ToTypeCode() + "();\n";
                    foreach (DataItem di in par.baseDataItem.baseType.fields)
						if (TypeKind.Multiple == di.typeKind)
                            code += ts + "\tthis.state." + di.GetTypeVarName() + " = undefined;\n";
                        else
                            code += ts + "\tthis.state." + par.ToVarCode() + "." + di.GetVarName() + " = " + par.ToVarCode() + "." + di.GetVarName() + ";\n";
                }
            }
            code += ts + "\tthis.gUpdateView?.(ScreenId." + pres.GetElemName().ToUpper().Substring(1) + ");\n" + ts + "}";
            return code;
        }
	}
}